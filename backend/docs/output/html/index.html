<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Komunikator: Documentation for &quot;Komunikator&quot; backend</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Komunikator
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="doc-content">
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){ initResizable(false); });
/* @license-end */
</script>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Documentation for "Komunikator" backend </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="autotoc_md0"></a>
Overview</h2>
<p>Komunikator app backend is built with Flask, Flask-SocketIO, and SQLAlchemy. It provides a REST API and WebSocket interface for user management, room-based messaging, and real-time presence tracking.</p>
<h2><a class="anchor" id="autotoc_md1"></a>
Features</h2>
<h3><a class="anchor" id="autotoc_md2"></a>
User Management</h3>
<ul>
<li><b>Authentication</b>: JWT-based user registration and login system</li>
<li><b>User Statistics</b>: Track message counts and room memberships</li>
<li><b>Online Status</b>: Real-time presence detection with automatic offline detection after inactivity</li>
</ul>
<h3><a class="anchor" id="autotoc_md3"></a>
Room Management</h3>
<ul>
<li><b>Public Rooms</b>: Open rooms visible to all users</li>
<li><b>Private Rooms</b>: Invite-only rooms with unique access keys</li>
<li><b>Room Operations</b>: Create, edit, delete, join, and leave rooms</li>
<li><b>User Lists</b>: View all users in a room with real-time updates</li>
<li><b>Room Moderation</b>: Room owners can kick users from their rooms</li>
</ul>
<h3><a class="anchor" id="autotoc_md4"></a>
Messaging</h3>
<ul>
<li><b>Real-Time Messages</b>: WebSocket-based instant message delivery</li>
<li><b>Chat History</b>: Persistent message storage with timestamps</li>
<li><b>Message Validation</b>: Automatic validation of message length and content</li>
<li><b>Broadcast System</b>: Efficient message distribution to room members</li>
</ul>
<h3><a class="anchor" id="autotoc_md5"></a>
Activity Tracking</h3>
<ul>
<li><b>Presence System</b>: Tracks user online/offline status across all rooms</li>
<li><b>Watchdog Mechanism</b>: Periodic heartbeat to maintain user presence</li>
<li><b>Automatic Cleanup</b>: Background task removes inactive users after timeout</li>
<li><b>Cross-Room Updates</b>: User status changes broadcast to all relevant rooms</li>
</ul>
<h2><a class="anchor" id="autotoc_md6"></a>
Architecture</h2>
<h3><a class="anchor" id="autotoc_md7"></a>
Database Layer (<code>db_objects.py</code>)</h3>
<p>Four main models represent the application's data:</p><ul>
<li><b>Users</b>: User accounts with credentials</li>
<li><b>Rooms</b>: Chat rooms with public/private access control</li>
<li><b>Users_room</b>: Many-to-many relationship between users and rooms</li>
<li><b>Chat_history</b>: Persistent message storage</li>
</ul>
<h3><a class="anchor" id="autotoc_md8"></a>
REST API Routes</h3>
<ul>
<li><code>/api/register</code> - User registration</li>
<li><code>/api/login</code> - User authentication</li>
<li><code>/api/user/change_password</code> - Password modification</li>
<li><code>/api/user/get_info</code> - User statistics</li>
<li><code>/api/users/online</code> - List of users online</li>
<li><code>/api/rooms</code> - Public room listing</li>
<li><code>/api/room/*</code> - Room management operations</li>
<li><code>/api/user_rooms</code> - User's room memberships</li>
<li><code>/api/user/list</code> - List of users in a room</li>
<li><code>/api/user_kick</code> - Forceful removal of a user by the room owner</li>
<li><code>/api/chat_history</code> - Historical messages</li>
</ul>
<h3><a class="anchor" id="autotoc_md9"></a>
WebSocket Events</h3>
<ul>
<li><code>join</code> - Connect to a room (sent to server)</li>
<li><code>leave</code> - Disconnect from a room (sent to server)</li>
<li><code>message</code> - Send a message to a room (sent to server)</li>
<li><code>watchdog</code> - Maintain user presence (sent to server)</li>
<li><code>user_list_updated</code> - Notify when user list was updated (sent to client)</li>
<li><code>room_list_updated</code> - Notify when room list was updated (sent to client)</li>
<li><code>user_online</code> - Notify when user status was changed to online (sent to rooms)</li>
<li><code>user_offline</code> - Notify when user status was changed to offline (sent to rooms)</li>
<li><code>user_joined</code> - Response for successful join event (sent to room)</li>
<li><code>user_left</code> - Response for successful leave event (sent to room)</li>
<li><code>new</code> - Response for message event (sent to room)</li>
<li><code>error</code> - Response on event failure (sent to client)</li>
</ul>
<h3><a class="anchor" id="autotoc_md10"></a>
Application State (<code>app_state.py</code>)</h3>
<p>In-memory state management:</p><ul>
<li><b>online_users</b>: Set of currently active users</li>
<li><b>user_last_seen</b>: Timestamp tracking for activity detection</li>
<li><b>room_users</b>: Mapping of rooms to their current users</li>
<li><b><a class="el" href="namespaceuser__rooms.html">user_rooms</a></b>: Mapping of users to their joined rooms</li>
</ul>
<h2><a class="anchor" id="autotoc_md11"></a>
Technology Stack</h2>
<ul>
<li><b>Flask</b>: Web framework</li>
<li><b>Flask-SocketIO</b>: WebSocket support</li>
<li><b>SQLAlchemy</b>: ORM and database management</li>
<li><b>Flask-JWT-Extended</b>: JWT authentication</li>
<li><b>MySQL</b>: Database backend</li>
<li><b>Flask-CORS</b>: Cross-origin resource sharing</li>
</ul>
<h2><a class="anchor" id="autotoc_md12"></a>
Getting Started</h2>
<p>Configure the following environment variables:</p><ul>
<li><code>DB_USER</code> - Database username</li>
<li><code>DB_PASSWORD</code> - Database password</li>
<li><code>DB_HOST</code> - Database host</li>
<li><code>DB_PORT</code> - Database port</li>
<li><code>DB_NAME</code> - Database name</li>
<li><code>JWT_SECRET_KEY</code> - Secret key for JWT tokens</li>
</ul>
<dl class="section author"><dt>Authors</dt><dd>Paweł Dyczek, Paweł Herzyk, Mikołaj Całus </dd></dl>
</div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
