<!DOCTYPE html>
<html>
<head>
    <title>SocketIO Test</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
</head>
<body>
    <h1>SocketIO Chat Test</h1>
    
    <div>
        <input type="text" id="room_id" placeholder="Room ID" value="1">
        <input type="text" id="user_name" placeholder="Username" value="user1">
        <button onclick="joinRoom()">Join Room</button>
        <button onclick="leaveRoom()">Leave Room</button>
    </div>
    
    <div style="margin-top: 20px;">
        <input type="text" id="message" placeholder="Wiadomość">
        <button onclick="sendMessage()">Wyślij</button>
    </div>
    
    <div id="log" style="margin-top: 20px; border: 1px solid #ccc; padding: 10px; height: 300px; overflow-y: auto;"></div>

    <script>
        const socket = io('http://localhost:5000');
        
        function log(msg) {
            const div = document.getElementById('log');
            div.innerHTML += `<p>${new Date().toLocaleTimeString()} - ${msg}</p>`;
            div.scrollTop = div.scrollHeight;
        }

        function watchdog(){
            const user_name = document.getElementById('user_name').value;
            const room_id = document.getElementById('room_id').value;
            socket.emit('watchdog', {
                user_name: user_name
            });
        }

        // Eventy Socket.io
        socket.on('connect', () => {
            log(`Połączono z serwerem (sid: ${socket.id})`);
            setInterval(() => {
             watchdog();
        }, 1000);
        });

        socket.on('disconnect', () => {
            log(' Rozłączono');
        });

        // response on join
        socket.on('user_joined', (data) => {
            log(`${data.user_name} dołączył do pokoju ${data.room_id}`);
        });

        // response on leave
        socket.on('user_left', (data) => {
            log(`${data.user_name} opuścił pokój ${data.room_id}`);
        });

        // response on watchdog
        socket.on('user_online', (data) => {
            console.log('user online ', data.user_name);
        });

        // response on API user_room table update
        socket.on('user_list_updated', () => {
            log(`user list updated`);
        });

        // response on error
        socket.on('error', (data) => {
            log(`Error: ${data.message}`);
        })

        // response on message
        socket.on('new_message', (data) => {
            log(`[User ${data.user_name}]: ${data.message}`);
        });

        function joinRoom() {
            const room_id = document.getElementById('room_id').value;
            const user_name = document.getElementById('user_name').value;
            socket.emit('join', { room_id: room_id, user_name: user_name });
            log(`Dołączam do pokoju ${room_id}...`);
        }

        function leaveRoom() {
            const room_id = document.getElementById('room_id').value;
            const user_name = document.getElementById('user_name').value;
            socket.emit('leave', { room_id: room_id, user_name: user_name });
            log(`Opuszczam pokój ${room_id}...`);
        }

        function sendMessage() {
            const room_id = document.getElementById('room_id').value;
            const message = document.getElementById('message').value;
            const user_name = document.getElementById('user_name').value;
            socket.emit('message', {
                room_id: room_id,
                user_name: user_name,
                message: message
            });
            document.getElementById('message').value = '';
        }

    </script>
</body>
</html>